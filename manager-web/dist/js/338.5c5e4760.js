"use strict";(self.webpackChunkxiaozhi=self.webpackChunkxiaozhi||[]).push([[338],{3394:function(e,t,i){i.r(t),i.d(t,{default:function(){return c}});var a=i(9237),s=i(7853),o=i(9145),n={props:{title:{type:String,default:"添加说话人"},visible:{type:Boolean,default:!1},agentId:{type:String},form:{type:Object,default:()=>({id:null,audioId:"",sourceName:"",introduce:""})}},data(){return{dialogKey:Date.now(),saving:!1,playingAudioId:null,audioElement:null,valueTypeOptions:[{audioId:"",content:""}],rules:{introduce:[{required:!0,message:"请输入描述",trigger:"blur"}],sourceName:[{required:!0,message:"请输入姓名",trigger:"blur"}],audioId:[{required:!0,message:"请选择音频向量",trigger:"change"}]}}},methods:{getAudioIconClass(e){return this.playingAudioId===e?"el-icon-loading":"el-icon-video-play"},playAudio(e){if(this.playingAudioId===e)return this.audioElement&&(this.audioElement.pause(),this.audioElement=null),void(this.playingAudioId=null);this.audioElement&&(this.audioElement.pause(),this.audioElement=null),this.playingAudioId=e,a.A.agent.getAudioId(e,(e=>{e.data&&e.data.data&&(this.audioElement=new Audio(a.A.getServiceUrl()+`/agent/play/${e.data.data}`),this.audioElement.onended=()=>{this.playingAudioId=null,this.audioElement=null},this.audioElement.play())}))},submit(){this.$refs.form.validate((e=>{e&&(this.saving=!0,this.$emit("submit",{form:this.form,done:()=>{this.saving=!1}}),setTimeout((()=>{this.saving=!1}),3e3))}))},cancel(){this.saving=!1,this.$emit("cancel")}},watch:{visible(e){e&&(this.dialogKey=Date.now())},agentId(e){e&&a.A.agent.getRecentlyFiftyByAgentId(this.agentId,(e=>{this.valueTypeOptions=e.data.data.map((e=>({...e})))}))},"form.audioId"(e){null!=e&&""!=e&&(this.valueTypeOptions.some((t=>t.audioId===e))||a.A.agent.getContentByAudioId(e,(t=>{this.valueTypeOptions.push({audioId:e,content:t.data.data})})))}}},l=i(1656),r=(0,l.A)(n,(function(){var e=this,t=e._self._c;return t("el-dialog",{key:e.dialogKey,staticClass:"param-dialog-wrapper",attrs:{title:e.title,visible:e.visible,width:"520px","append-to-body":!0,"close-on-click-modal":!1,"custom-class":"custom-param-dialog","show-close":!1},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"dialog-container"},[t("div",{staticClass:"dialog-header"},[t("h2",{staticClass:"dialog-title"},[e._v(e._s(e.title))]),t("button",{staticClass:"custom-close-btn",on:{click:e.cancel}},[t("svg",{attrs:{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M13 1L1 13M1 1L13 13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}})])])]),t("el-form",{ref:"form",staticClass:"param-form",attrs:{model:e.form,rules:e.rules,"label-width":"110px","label-position":"left"}},[t("el-form-item",{staticClass:"form-item",attrs:{label:"声纹向量",prop:"audioId"}},[t("el-select",{staticClass:"custom-select",attrs:{placeholder:"请选择一条语言消息"},model:{value:e.form.audioId,callback:function(t){e.$set(e.form,"audioId",t)},expression:"form.audioId"}},e._l(e.valueTypeOptions,(function(i){return t("el-option",{key:i.audioId,attrs:{label:i.content,value:i.audioId}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(i.content))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t("i",{staticClass:"audio-icon",class:e.getAudioIconClass(i.audioId),on:{click:function(t){return t.stopPropagation(),e.playAudio(i.audioId)}}})])])})),1)],1),t("el-form-item",{staticClass:"form-item",attrs:{label:"姓名",prop:"sourceName"}},[t("el-input",{staticClass:"custom-input",attrs:{placeholder:"请输入姓名"},model:{value:e.form.sourceName,callback:function(t){e.$set(e.form,"sourceName",t)},expression:"form.sourceName"}})],1),t("el-form-item",{staticClass:"form-item remark-item",attrs:{label:"描述",prop:"introduce"}},[t("el-input",{staticClass:"custom-textarea",attrs:{type:"textarea",placeholder:"请输入描述",rows:3,maxlength:"100","show-word-limit":""},model:{value:e.form.introduce,callback:function(t){e.$set(e.form,"introduce",t)},expression:"form.introduce"}})],1)],1),t("div",{staticClass:"dialog-footer"},[t("el-button",{staticClass:"save-btn",attrs:{type:"primary",loading:e.saving,disabled:e.saving},on:{click:e.submit}},[e._v(" 保存 ")]),t("el-button",{staticClass:"cancel-btn",on:{click:e.cancel}},[e._v(" 取消 ")])],1)],1)])}),[],!1,null,"4bbe82c1",null).exports,d={components:{HeaderBar:s.A,VoicePrintDialog:r,VersionFooter:o.A},data(){return{voicePrintList:[],loading:!1,dialogVisible:!1,dialogTitle:"添加说话人",isAllSelected:!1,paramForm:{id:null,audioId:"",sourceName:"",introduce:""},agentId:"1"}},mounted(){const e=this.$route.query.agentId;e&&(this.agentId=e,this.fetchVoicePrints())},methods:{fetchVoicePrints(){this.loading=!0,a.A.agent.getAgentVoicePrintList(this.agentId,(({data:e})=>{this.loading=!1,0===e.code?this.voicePrintList=e.data.map((e=>({...e}))):this.$message.error({message:e.msg||"获取声纹列表失败",showClose:!0})}))},showAddDialog(){this.dialogTitle="添加说话人",this.paramForm={id:null,audioId:"",sourceName:"",introduce:""},this.dialogVisible=!0},editVoicePrint(e){this.dialogTitle="编辑说话人",this.paramForm={...e},this.dialogVisible=!0},handleSubmit({form:e,done:t}){e.id?a.A.agent.updateAgentVoicePrint(e,(({data:e})=>{0===e.code&&(this.$message.success({message:"修改成功",showClose:!0}),this.dialogVisible=!1,this.fetchVoicePrints()),t&&t()})):a.A.agent.addAgentVoicePrint({agentId:this.agentId,audioId:e.audioId,sourceName:e.sourceName,introduce:e.introduce},(({data:e})=>{0===e.code&&(this.$message.success({message:"新增成功",showClose:!0}),this.dialogVisible=!1,this.fetchVoicePrints()),t&&t()}))},deleteVoicePrint(e){this.$confirm("确定要删除选中的此声纹吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}).then((()=>{a.A.agent.deleteAgentVoicePrint(e,(({data:e})=>{0===e.code?(this.$message.success({message:"成功删除此声纹",showClose:!0}),this.fetchVoicePrints()):this.$message.error({message:e.msg||"删除失败，请重试",showClose:!0})}))})).catch((e=>{"cancel"===e?this.$message({type:"info",message:"已取消删除操作",duration:1e3}):this.$message({type:"info",message:"操作已关闭",duration:1e3})}))}}},c=(0,l.A)(d,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"welcome"},[t("HeaderBar"),e._m(0),t("div",{staticClass:"main-wrapper"},[t("div",{staticClass:"content-panel"},[t("div",{staticClass:"content-area"},[t("el-card",{staticClass:"voice-print-card",attrs:{shadow:"never"}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"paramsTable",staticClass:"transparent-table",attrs:{data:e.voicePrintList,"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.7)"}},[t("el-table-column",{attrs:{label:"姓名",prop:"sourceName",align:"center"}}),t("el-table-column",{attrs:{label:"描述",prop:"introduce",align:"center"}}),t("el-table-column",{attrs:{label:"创建时间",prop:"createDate",align:"center"}}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.editVoicePrint(i.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteVoicePrint(i.row.id)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"table_bottom"},[t("div",{staticClass:"ctrl_btn"},[t("el-button",{attrs:{size:"mini",type:"success"},on:{click:e.showAddDialog}},[e._v("新增")])],1)])],1)],1)])]),t("voice-print-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,agentId:e.agentId,form:e.paramForm},on:{"update:visible":function(t){e.dialogVisible=t},submit:e.handleSubmit,cancel:function(t){e.dialogVisible=!1}}}),t("el-footer",[t("version-footer")],1)],1)}),[function(){var e=this._self._c;return e("div",{staticClass:"operation-bar"},[e("h2",{staticClass:"page-title"},[this._v("声纹识别")])])}],!1,null,"578bc8fa",null).exports},9145:function(e,t,i){i.d(t,{A:function(){return s}});var a={name:"VersionFooter",computed:{...(0,i(5353).aH)({version:e=>e.pubConfig.version,name:e=>e.pubConfig.name,beianIcpNum:e=>e.pubConfig.beianIcpNum,beianGaNum:e=>e.pubConfig.beianGaNum,year:e=>e.pubConfig.year})},mounted(){this.$store.dispatch("fetchPubConfig")}},s=(0,i(1656).A)(a,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"copyright"},[t("div",{staticClass:"footer-content"},[t("span",[e._v(e._s(e.year)+" "+e._s(e.name)+" "+e._s(e.version))]),"null"!==e.beianGaNum?["null"!==e.beianIcpNum||e.name?t("span",[e._v("|")]):e._e(),t("a",{staticClass:"beian-link",attrs:{href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="+e.beianGaNum,target:"_blank",rel:"noopener"}},[t("img",{staticClass:"beian-icon",attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAACXlBMVEUAAADax4rGxqP556zmsVD/6KXu5JvwvFPglEFnY3nnpEjosU1+XFTmuVfu13Hrv1jpsFa1k3mne2HlvnPdqmPqz3fu3YrJoWv04J/mz5z246aSi3i2p2/0zGj82WDrtFjar1O7klO4dkfimUJcWnbho0rgr1vntFfmvFflvGOZdFKXZkOUemnmv2XkuWWVe2ziqlXnt1Tr0HDpwl6ObmCkbEKqhVyOc2jdoVHmuljfrmDq0nPapWDUnErqy3XjtWXesXLrzHjz34rqzYfmw3fy4YrqyYDevW/dzoTIhkndsXLRsIneuHjlyIzQroTjuXjlyYfktWvw2prhvoHTmGfx45j3773TuYT/25LdijyKf321oXU+Nm3cumXfuWLtwlzpwVz40FvpvlvqvFfouFXjrlHipEjcmEfknEXPbzfbZyzZQR/YMBrWKBrhJhLdHxDTGg5HV4xBT4YYKYaWk4SDgYIWIYBybH0qLn1KS3tlZHpNS3WGfHIcHXEwLHAnF28rKW07NGuzn2pNQ2ruzWnDrGnuy2jryGjAnGgoH2j1x2RCNGPcrmIsEGGQdl/pu17YtV7FoV3muVxoRVzWqFvSmVp2SVbyw1XbkVTuvFPfo1PgmVPpt1LcnFLWkVLlp1F7W1HpsU92QE5oMUtFAUrpqUjnjUFOAEHUgz+DUj14FzvbczieMTdhATfodjXWcDXcbjXVcTS/Xi/hay7WXS3cWS3vYyvaVSrUVymnJSjXSyeKDSbNSiWfHCPMTyLFQiHkSR/lPxvVLRrPLBnUJRfUHhbaJxXVGxTZJxPNFhBdOhm/AAAAWXRSTlMABQIU/hIJ/v79/Pj29PPx4cC6s7CNfmxZWRv+/v7+/v7+/v78/Pr6+fPz8vHq6ujl5eTj4ODe2NTQzMW6ubKsnJeQkJCJiIOBgX9ubGpoW1lMREM0JR8dDgvYx1gAAAE7SURBVBjTYgADJmZJQUFJZiYGOGD2EzLV1jIT8paCibCJ86zctGPD1D4ecUaICKuPyYLMYznZOfNqzP0jwEJBOt1KB4/mHjqZ3dGsHwxW5M4Zk5l/PPdIQcGMShUPVqBlgQLlMSvyDq+P3HVidjWnkQQTA5MXV1SFYtb+jZGrl02si2J3Y2JgFMmILl68efueLVvXLSqLXirCCBgDow1HT+GS/AP7srblLS+K5bIHCjmodpXUr929d+eaVb3SsuouQCHhufPjShsbJk/rrK2KW8hiBxRyVkvnkI9tnaDQJDNFOU1DDOjRMEfe9Mjpiewz5RIzZmmKMoPcKqGbkJqSkBSfnDqpXS+ACeRpJ76W/uSUpDlpLPFtfK5soLAKFbU05Odm4eblN7YWk4KEGWOIp62FgYCVsG84SAAAL7BaooX965sAAAAASUVORK5CYII=",alt:"备案图标"}}),t("span",{staticClass:"beian-text"},[e._v(e._s(e.beianGaNum))])])]:e._e(),"null"!==e.beianIcpNum?[e.name?t("span",[e._v("|")]):e._e(),t("a",{staticClass:"beian-link",attrs:{href:"https://beian.miit.gov.cn/",target:"_blank",rel:"noopener"}},[t("span",{staticClass:"beian-text"},[e._v(e._s(e.beianIcpNum))])])]:e._e()],2)])}),[],!1,null,"1bdde94e",null).exports}}]);