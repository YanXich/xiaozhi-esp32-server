"use strict";(self.webpackChunkxiaozhi=self.webpackChunkxiaozhi||[]).push([[390],{8753:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var a=s(9237),i=s(7853),n=s(9145),l={name:"ViewPasswordDialog",props:{visible:{type:Boolean,required:!0},password:{type:String,default:""}},methods:{closeDialog(){this.$emit("update:visible",!1)},copyPassword(){navigator.clipboard.writeText(this.password),this.$message.success({message:"密码已复制",showClose:!0})}}},r=s(1656),o=(0,r.A)(l,(function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.visible,width:"400px",center:""},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticStyle:{margin:"0 10px 10px",display:"flex","align-items":"center",gap:"10px","font-weight":"700","font-size":"20px","text-align":"left",color:"#3d4566"}},[t("div",{staticStyle:{width:"40px",height:"40px","border-radius":"50%",background:"#5778ff",display:"flex","align-items":"center","justify-content":"center"}},[t("img",{staticStyle:{width:"19px",height:"23px",filter:"brightness(0) invert(1)"},attrs:{src:s(8253),alt:""}})]),e._v(" 用户新密码 ")]),t("div",{staticStyle:{height:"1px",background:"#e8f0ff"}}),t("div",{staticStyle:{margin:"22px 15px"}},[t("div",{staticStyle:{"font-weight":"400","font-size":"14px","text-align":"left",color:"#3d4566"}},[t("div",{staticStyle:{color:"red",display:"inline-block"}},[e._v("*")]),e._v(" 用户新密码： ")]),t("div",{staticClass:"input-46",staticStyle:{"margin-top":"12px"}},[t("el-input",{staticStyle:{"font-weight":"bold",color:"#333"},attrs:{type:"text",readonly:!0},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)]),t("div",{staticStyle:{display:"flex",margin:"15px 15px",gap:"7px"}},[t("div",{staticClass:"dialog-btn",staticStyle:{background:"#e6ebff",border:"1px solid #adbdff",color:"#5778ff"},on:{click:e.closeDialog}},[e._v(" 关闭 ")]),t("div",{staticClass:"dialog-btn",staticStyle:{background:"#5778ff",color:"white"},on:{click:e.copyPassword}},[e._v(" 复制密码 ")])])])}),[],!1,null,"6f547131",null).exports,c={components:{HeaderBar:i.A,ViewPasswordDialog:o,VersionFooter:n.A},data(){return{showViewPassword:!1,currentPassword:"",searchPhone:"",userList:[],pageSizeOptions:[10,20,50,100],currentPage:1,pageSize:10,total:0,isAllSelected:!1,loading:!1}},created(){this.fetchUsers()},computed:{pageCount(){return Math.ceil(this.total/this.pageSize)},visiblePages(){const e=[];let t=Math.max(1,this.currentPage-1),s=Math.min(this.pageCount,t+3-1);s-t+1<3&&(t=Math.max(1,s-3+1));for(let a=t;a<=s;a++)e.push(a);return e}},methods:{handlePageSizeChange(e){this.pageSize=e,this.currentPage=1,this.fetchUsers()},fetchUsers(){this.loading=!0,a.A.admin.getUserList({page:this.currentPage,limit:this.pageSize,mobile:this.searchPhone},(({data:e})=>{this.loading=!1,0===e.code&&(this.userList=e.data.list.map((e=>({...e,selected:!1}))),this.total=e.data.total)}))},handleSearch(){this.currentPage=1,this.fetchUsers()},handleSelectAll(){this.isAllSelected=!this.isAllSelected,this.userList.forEach((e=>{e.selected=this.isAllSelected}))},batchDelete(){const e=this.userList.filter((e=>e.selected));0!==e.length?this.$confirm(`确定要删除选中的${e.length}个用户吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const t=this.$loading({lock:!0,text:"正在删除中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});try{const t=await Promise.all(e.map((e=>new Promise((t=>{a.A.admin.deleteUser(e.userid,(({data:s})=>{0===s.code?t({success:!0,userid:e.userid}):t({success:!1,userid:e.userid,msg:s.msg})}))}))))),s=t.filter((e=>e.success)).length,i=t.length-s;0===i?this.$message.success({message:`成功删除${s}个用户`,showClose:!0}):0===s?this.$message.error({message:"删除失败，请重试",showClose:!0}):this.$message.warning(`成功删除${s}个用户，${i}个删除失败`),this.fetchUsers()}catch(e){this.$message.error("删除过程中发生错误")}finally{t.close()}})).catch((()=>{this.$message.info("已取消删除")})):this.$message.warning("请先选择需要删除的用户")},batchEnable(){const e=this.userList.filter((e=>e.selected));this.handleChangeStatus(e,1)},batchDisable(){const e=this.userList.filter((e=>e.selected));this.handleChangeStatus(e,0)},resetPassword(e){this.$confirm("重置后将会生成新密码，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{a.A.admin.resetUserPassword(e.userid,(({data:e})=>{0===e.code&&(this.currentPassword=e.data,this.showViewPassword=!0,this.$message.success({message:"密码已重置，请通知用户使用新密码登录",showClose:!0}))}))}))},deleteUser(e){this.$confirm("确定要删除该用户吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a.A.admin.deleteUser(e.userid,(({data:e})=>{0===e.code?(this.$message.success({message:"删除成功",showClose:!0}),this.fetchUsers()):this.$message.error({message:e.msg||"删除失败",showClose:!0})}))})).catch((()=>{}))},goFirst(){this.currentPage=1,this.fetchUsers()},goPrev(){this.currentPage>1&&(this.currentPage--,this.fetchUsers())},goNext(){this.currentPage<this.pageCount&&(this.currentPage++,this.fetchUsers())},goToPage(e){this.currentPage=e,this.fetchUsers()},handleChangeStatus(e,t){const s=Array.isArray(e)?e:[e],i=0===t?"禁用":"启用",n=s.length;this.$confirm(`确定要${i}选中的${n}个用户吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=s.map((e=>e.userid));e.some((e=>isNaN(e)))?this.$message.error("存在无效的用户ID"):a.A.user.changeUserStatus(t,e,(({data:e})=>{0===e.code?(this.$message.success({message:`成功${i}${n}个用户`,showClose:!0}),this.fetchUsers()):this.$message.error({message:"操作失败，请重试",showClose:!0})}))})).catch((()=>{}))}}},u=(0,r.A)(c,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"welcome"},[t("HeaderBar"),t("div",{staticClass:"operation-bar"},[t("h2",{staticClass:"page-title"},[e._v("用户管理")]),t("div",{staticClass:"right-operations"},[t("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入手机号码查询",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchPhone,callback:function(t){e.searchPhone=t},expression:"searchPhone"}}),t("el-button",{staticClass:"btn-search",on:{click:e.handleSearch}},[e._v("搜索")])],1)]),t("div",{staticClass:"main-wrapper"},[t("div",{staticClass:"content-panel"},[t("div",{staticClass:"content-area"},[t("el-card",{staticClass:"user-card",attrs:{shadow:"never"}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"userTable",staticClass:"transparent-table",attrs:{data:e.userList,"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.7)"}},[t("el-table-column",{attrs:{label:"选择",align:"center",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-checkbox",{model:{value:s.row.selected,callback:function(t){e.$set(s.row,"selected",t)},expression:"scope.row.selected"}})]}}])}),t("el-table-column",{attrs:{label:"用户Id",prop:"userid",align:"center"}}),t("el-table-column",{attrs:{label:"手机号码",prop:"mobile",align:"center"}}),t("el-table-column",{attrs:{label:"设备数量",prop:"deviceCount",align:"center"}}),t("el-table-column",{attrs:{label:"注册时间",prop:"createDate",align:"center"}}),t("el-table-column",{attrs:{label:"状态",prop:"status",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[1===s.row.status?t("el-tag",{attrs:{type:"success"}},[e._v("正常")]):t("el-tag",{attrs:{type:"danger"}},[e._v("禁用")])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.resetPassword(s.row)}}},[e._v("重置密码")]),1===s.row.status?t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleChangeStatus(s.row,0)}}},[e._v("禁用账户")]):e._e(),0===s.row.status?t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleChangeStatus(s.row,1)}}},[e._v("恢复账号")]):e._e(),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteUser(s.row)}}},[e._v("删除用户")])]}}])})],1),t("div",{staticClass:"table_bottom"},[t("div",{staticClass:"ctrl_btn"},[t("el-button",{staticClass:"select-all-btn",attrs:{size:"mini",type:"primary"},on:{click:e.handleSelectAll}},[e._v(" "+e._s(e.isAllSelected?"取消全选":"全选")+" ")]),t("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-circle-check"},on:{click:e.batchEnable}},[e._v("启用")]),t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:e.batchDisable}},[t("i",{staticClass:"el-icon-remove-outline rotated-icon"}),e._v("禁用")]),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:e.batchDelete}},[e._v("删除")])],1),t("div",{staticClass:"custom-pagination"},[t("el-select",{staticClass:"page-size-select",on:{change:e.handlePageSizeChange},model:{value:e.pageSize,callback:function(t){e.pageSize=t},expression:"pageSize"}},e._l(e.pageSizeOptions,(function(e){return t("el-option",{key:e,attrs:{label:`${e}条/页`,value:e}})})),1),t("button",{staticClass:"pagination-btn",attrs:{disabled:1===e.currentPage},on:{click:e.goFirst}},[e._v(" 首页 ")]),t("button",{staticClass:"pagination-btn",attrs:{disabled:1===e.currentPage},on:{click:e.goPrev}},[e._v(" 上一页 ")]),e._l(e.visiblePages,(function(s){return t("button",{key:s,staticClass:"pagination-btn",class:{active:s===e.currentPage},on:{click:function(t){return e.goToPage(s)}}},[e._v(" "+e._s(s)+" ")])})),e._v(" "),t("button",{staticClass:"pagination-btn",attrs:{disabled:e.currentPage===e.pageCount},on:{click:e.goNext}},[e._v(" 下一页 ")]),t("span",{staticClass:"total-text"},[e._v("共"+e._s(e.total)+"条记录")])],2)])],1)],1)])]),t("view-password-dialog",{attrs:{visible:e.showViewPassword,password:e.currentPassword},on:{"update:visible":function(t){e.showViewPassword=t}}}),t("el-footer",[t("version-footer")],1)],1)}),[],!1,null,"6c734947",null),d=u.exports},9145:function(e,t,s){s.d(t,{A:function(){return i}});var a={name:"VersionFooter",computed:{...(0,s(5353).aH)({version:e=>e.pubConfig.version,name:e=>e.pubConfig.name,beianIcpNum:e=>e.pubConfig.beianIcpNum,beianGaNum:e=>e.pubConfig.beianGaNum,year:e=>e.pubConfig.year})},mounted(){this.$store.dispatch("fetchPubConfig")}},i=(0,s(1656).A)(a,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"copyright"},[t("div",{staticClass:"footer-content"},[t("span",[e._v(e._s(e.year)+" "+e._s(e.name)+" "+e._s(e.version))]),"null"!==e.beianGaNum?["null"!==e.beianIcpNum||e.name?t("span",[e._v("|")]):e._e(),t("a",{staticClass:"beian-link",attrs:{href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode="+e.beianGaNum,target:"_blank",rel:"noopener"}},[t("img",{staticClass:"beian-icon",attrs:{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAMAAABhEH5lAAACXlBMVEUAAADax4rGxqP556zmsVD/6KXu5JvwvFPglEFnY3nnpEjosU1+XFTmuVfu13Hrv1jpsFa1k3mne2HlvnPdqmPqz3fu3YrJoWv04J/mz5z246aSi3i2p2/0zGj82WDrtFjar1O7klO4dkfimUJcWnbho0rgr1vntFfmvFflvGOZdFKXZkOUemnmv2XkuWWVe2ziqlXnt1Tr0HDpwl6ObmCkbEKqhVyOc2jdoVHmuljfrmDq0nPapWDUnErqy3XjtWXesXLrzHjz34rqzYfmw3fy4YrqyYDevW/dzoTIhkndsXLRsIneuHjlyIzQroTjuXjlyYfktWvw2prhvoHTmGfx45j3773TuYT/25LdijyKf321oXU+Nm3cumXfuWLtwlzpwVz40FvpvlvqvFfouFXjrlHipEjcmEfknEXPbzfbZyzZQR/YMBrWKBrhJhLdHxDTGg5HV4xBT4YYKYaWk4SDgYIWIYBybH0qLn1KS3tlZHpNS3WGfHIcHXEwLHAnF28rKW07NGuzn2pNQ2ruzWnDrGnuy2jryGjAnGgoH2j1x2RCNGPcrmIsEGGQdl/pu17YtV7FoV3muVxoRVzWqFvSmVp2SVbyw1XbkVTuvFPfo1PgmVPpt1LcnFLWkVLlp1F7W1HpsU92QE5oMUtFAUrpqUjnjUFOAEHUgz+DUj14FzvbczieMTdhATfodjXWcDXcbjXVcTS/Xi/hay7WXS3cWS3vYyvaVSrUVymnJSjXSyeKDSbNSiWfHCPMTyLFQiHkSR/lPxvVLRrPLBnUJRfUHhbaJxXVGxTZJxPNFhBdOhm/AAAAWXRSTlMABQIU/hIJ/v79/Pj29PPx4cC6s7CNfmxZWRv+/v7+/v7+/v78/Pr6+fPz8vHq6ujl5eTj4ODe2NTQzMW6ubKsnJeQkJCJiIOBgX9ubGpoW1lMREM0JR8dDgvYx1gAAAE7SURBVBjTYgADJmZJQUFJZiYGOGD2EzLV1jIT8paCibCJ86zctGPD1D4ecUaICKuPyYLMYznZOfNqzP0jwEJBOt1KB4/mHjqZ3dGsHwxW5M4Zk5l/PPdIQcGMShUPVqBlgQLlMSvyDq+P3HVidjWnkQQTA5MXV1SFYtb+jZGrl02si2J3Y2JgFMmILl68efueLVvXLSqLXirCCBgDow1HT+GS/AP7srblLS+K5bIHCjmodpXUr929d+eaVb3SsuouQCHhufPjShsbJk/rrK2KW8hiBxRyVkvnkI9tnaDQJDNFOU1DDOjRMEfe9Mjpiewz5RIzZmmKMoPcKqGbkJqSkBSfnDqpXS+ACeRpJ76W/uSUpDlpLPFtfK5soLAKFbU05Odm4eblN7YWk4KEGWOIp62FgYCVsG84SAAAL7BaooX965sAAAAASUVORK5CYII=",alt:"备案图标"}}),t("span",{staticClass:"beian-text"},[e._v(e._s(e.beianGaNum))])])]:e._e(),"null"!==e.beianIcpNum?[e.name?t("span",[e._v("|")]):e._e(),t("a",{staticClass:"beian-link",attrs:{href:"https://beian.miit.gov.cn/",target:"_blank",rel:"noopener"}},[t("span",{staticClass:"beian-text"},[e._v(e._s(e.beianIcpNum))])])]:e._e()],2)])}),[],!1,null,"1bdde94e",null).exports}}]);