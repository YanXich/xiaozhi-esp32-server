"use strict";(self.webpackChunkxiaozhi=self.webpackChunkxiaozhi||[]).push([[382],{4498:function(t){t.exports="data:image/png;base64,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"},6938:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABTFJREFUaEPVmn+IVFUUxz/nvVFXjK0kIyL/ainUpcCI8q+EoMDCkNqZRA0Fw8iEDGVnF6kRSnfVftBWlBYWKtvOGqEEohTsH4FEEG64K4ILgUVRoTS4tevOeyfvm511dnZmd+a9O1PePx/3fu/53nPvPed87xMitjUpbfRGuBu4X2Ex8CCwQOFmgbsMvMLPAn8BfwDfCwwC/W4DQ0dSkoligoQd3NKmC/BY6bi0oAGBpiqxLiAM+R69uBzv3S2GXNWtagKr2/U+z2OlCNuBxqpnLD0go8pe1+V49y75sRrMigms26bzrrqsRdgKwYrHqpmogr5ZYAjl7dkehw/tk+EKxjAjgVRKnXNXWYxPF7C8EtCIfbIofbhsXTSbwVRK/OnwZiSQ2K5P4rIbaI5oWLXDz+LR1rNXvgpFwGyZsRgtCh8Cc6qd3VL/UYUNc7IcL7elynrg2aSuV+FNlPmWjAkHI1xS5aV0h3SXAphCINjzw6zA5eh/uPLFto6irFo0l5PFZ2IKgUS7NuNj2NZ7z0/vIeUMLut6dsnZwo6TCARXZYyvgYfD+XtilAecQbkYfBEWAg9ExDQh/ZvM3zxxoktG81iTCCRadRMSHNoozUP5dEzYddulHIE/57MwBq8KrAXcCOBZ3+eF3j3yyRQCJsL6Pmng3ggToErXHI+24lvDeHfUZbcIW6LgA+cdh3g+Yk94IN6qO0R4LWqEdZTm7k4ZKGXk6lZd4guT9nAIMllVdqY75fXc7gRMYuYoF2zkNj0dMm1wTCRVQxhdPCTjC00mAQwmSyR1I3DAAjCZYRoKD1khpkm9syNBWm2jPd/TIR/Lmi3amL2JNMrjNlB95cUlc/mo+L428WXgHzY5wgc25kE4GbtCXBLbdSmxgIDJMCM3Vc55Hhu+2CffFYI9vU0fcl0OirAo8iS5zT9ElrgEKQMctAJ6HSSjwruO8oP55AtLRYP6wWZOlVV4ThJJ3QMBeC1aPuDYNHzCToGdxgN9Co9YsN4YOwT8XgbrHuAOwLEwVwDhwymJJ3VAcsV4pCbw7ViWzc4sfi0F5Hg8hoPx9p2RJioYrDBoCFzMqwdRgBV2pjskVQ5jPNaYSG+tqgvUDkuBxUgndScQXEbWCCgHbrnM5v37ZayUF2rhgYCArS0E/ILSK0L/rCy9xclcLQgEW8jWIS5Y9T5fiBcLVTUiMGjzGs1zqBuB4BqtQSCrG4F8ILOdStSLgKewznoyd+2erw+BfDJnMZ32fBhw4Uu3gbeKZfNxGf4VD1Y5sCRibWyy0Vw6bU6elYJG+DxzhfXlipn8CR9XPkxEXhEl8l+7tnMFjQGxVFK+0dMhOyoxKpFUQ6Clkr5l+kwuKU2n8aLe5DKhZI+ZUolCQyIS8K5V1alJRb0BjyqrCHz2WwMb+1JidP6ybXlKY7ePkBZYFdIDpWWV4CzkhK33Q3phWOG0wOXpDFO4VWAZMC8EAbP669Odcjg/dqq06HIM4dEQ4LUfMpO0GHihXZvVp1v+b+Iu9OOwdlpx1xC44eX1/D6IJ3W1CO/dcA8chQFnNMZKyUkuNVEVKjg04Z+Y8uDmkU+Nqlz/M9GP0tbTKSemIzrjK+XEM6vHO0hQkIcKdBWsdr6LeV8wz6wvW3lmnZTDXH/oNr8V2CZiXnWMQr4vM8yhmXKqknGgklW6YX81KCY3ngA+hfBM8KNHdeKwh/BTsOLKUV84VrefPYqJBPVEA03qsNgRmjxYNi6UNRb+bgNkjIrgwmkfzovH+dgIF450Rfvd5l94I1AlhMn7AQAAAABJRU5ErkJggg=="},7841:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var a=s(9237),o={props:{value:Boolean,functions:{type:Array,default:()=>[]},allFunctions:{type:Array,default:()=>[]},agentId:{type:String,required:!0}},data(){return{textCache:{},dialogVisible:this.value,selectedNames:[],currentFunction:null,modifiedFunctions:{},functionColorMap:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#A2836E"],tempFunctions:{},hasSaved:!1,loading:!1,mcpUrl:"",mcpStatus:"disconnected",mcpTools:[]}},computed:{selectedList(){return this.allFunctions.filter((t=>this.selectedNames.includes(t.name)))},unselected(){return this.allFunctions.filter((t=>!this.selectedNames.includes(t.name)))}},watch:{currentFunction(t){t&&t.fieldsMeta.forEach((e=>{const s=t.params[e.key];if("array"===e.type)this.$set(this.textCache,e.key,Array.isArray(s)?s.join("\n"):"");else if("json"===e.type)try{this.$set(this.textCache,e.key,JSON.stringify(s??{},null,2))}catch{this.$set(this.textCache,e.key,"")}}))},value(t){this.dialogVisible=t,t&&(this.selectedNames=this.functions.map((t=>t.name)),this.functions.forEach((t=>{const e=this.allFunctions.findIndex((e=>e.name===t.name));e>=0&&(this.allFunctions[e].params={...t.params})})),this.currentFunction=this.selectedList[0]||null,this.loadMcpAddress(),this.loadMcpTools())},dialogVisible(t){this.$emit("input",t)}},methods:{copyUrl(){const t=document.createElement("textarea");t.value=this.mcpUrl,t.style.position="fixed",document.body.appendChild(t),t.select();try{document.execCommand("copy")?this.$message.success("已复制到剪贴板"):this.$message.error("复制失败，请手动复制")}catch(t){this.$message.error("复制失败，请手动复制"),console.error("复制失败:",t)}finally{document.body.removeChild(t)}},refreshStatus(){this.mcpStatus="loading",this.loadMcpTools()},loadMcpAddress(){a.A.agent.getAgentMcpAccessAddress(this.agentId,(t=>{0===t.data.code?this.mcpUrl=t.data.data||"":(this.mcpUrl="",console.error("获取MCP地址失败:",t.data.msg))}))},loadMcpTools(){a.A.agent.getAgentMcpToolsList(this.agentId,(t=>{0===t.data.code?(this.mcpTools=t.data.data||[],this.mcpStatus=this.mcpTools.length>0?"connected":"disconnected"):(this.mcpTools=[],this.mcpStatus="disconnected",console.error("获取MCP工具列表失败:",t.data.msg))}))},flushArray(t){const e=(this.textCache[t]||"").split("\n").map((t=>t.trim())).filter(Boolean);this.handleParamChange(this.currentFunction,t,e)},flushJson(t){const e=t.key;if(!e)return;const s=this.textCache[e]||"";try{const t=JSON.parse(s);this.handleParamChange(this.currentFunction,e,t)}catch{this.$message.error(`${this.currentFunction.name}的${e}字段格式错误：JSON格式有误`)}},handleFunctionClick(t){if(this.selectedNames.includes(t.name)){const e=this.tempFunctions[t.name];this.currentFunction=e||t}},handleParamChange(t,e,s){this.tempFunctions[t.name]||(this.tempFunctions[t.name]=JSON.parse(JSON.stringify(t))),this.tempFunctions[t.name].params[e]=s},handleCheckboxChange(t,e){e?this.selectedNames.includes(t.name)||(this.selectedNames=[...this.selectedNames,t.name]):this.selectedNames=this.selectedNames.filter((e=>e!==t.name)),this.selectedList.length>0?this.currentFunction=this.selectedList[0]:this.currentFunction=null},selectAll(){this.selectedNames=[...this.allFunctions.map((t=>t.name))],this.selectedList.length>0&&(this.currentFunction=JSON.parse(JSON.stringify(this.selectedList[0])))},deselectAll(){this.selectedNames=[],this.currentFunction=null},closeDialog(){this.tempFunctions={},this.selectedNames=this.functions.map((t=>t.name)),this.currentFunction=null,this.dialogVisible=!1,this.$emit("input",!1),this.$emit("dialog-closed",!1)},saveSelection(){Object.keys(this.tempFunctions).forEach((t=>{this.modifiedFunctions[t]=JSON.parse(JSON.stringify(this.tempFunctions[t]))})),this.tempFunctions={},this.hasSaved=!0;const t=this.selectedList.map((t=>{const e=this.modifiedFunctions[t.name];return{id:t.id,name:t.name,params:e?{...e.params}:{...t.params}}}));this.$emit("update-functions",t),this.dialogVisible=!1,this.$emit("dialog-closed",!0)},getFunctionColor(t){const e=[...t].reduce(((t,e)=>t+e.charCodeAt(0)),0);return this.functionColorMap[e%this.functionColorMap.length]},fieldRemark(t){let e=t&&t.label?t.label:"";return t.default&&(e+=`（默认值：${t.default}）`),e}}},l=s(1656),n=(0,l.A)(o,(function(){var t=this,e=t._self._c;return e("el-drawer",{attrs:{visible:t.dialogVisible,direction:"rtl",size:"80%",wrapperClosable:!1,withHeader:!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"custom-header"},[e("div",{staticClass:"header-left"},[e("h3",{staticClass:"bold-title"},[t._v("功能管理")])]),e("button",{staticClass:"custom-close-btn",on:{click:t.closeDialog}},[t._v("×")])]),e("div",{staticClass:"function-manager"},[e("div",{staticClass:"function-column"},[e("div",{staticClass:"column-header"},[e("h4",{staticClass:"column-title"},[t._v("未选功能")]),e("el-button",{staticClass:"select-all-btn",attrs:{type:"text"},on:{click:t.selectAll}},[t._v("全选")])],1),e("div",{staticClass:"function-list"},[t.unselected.length?e("div",t._l(t.unselected,(function(s){return e("div",{key:s.name,staticClass:"function-item"},[e("el-checkbox",{attrs:{label:s.name},on:{change:e=>t.handleCheckboxChange(s,e)},nativeOn:{click:function(t){t.stopPropagation()}},model:{value:t.selectedNames,callback:function(e){t.selectedNames=e},expression:"selectedNames"}}),e("div",{staticClass:"func-tag",on:{click:function(e){return t.handleFunctionClick(s)}}},[e("div",{staticClass:"color-dot",style:{backgroundColor:t.getFunctionColor(s.name)}}),e("span",[t._v(t._s(s.name))])])],1)})),0):e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[e("el-empty",{attrs:{description:"没有更多的插件了"}})],1)])]),e("div",{staticClass:"function-column"},[e("div",{staticClass:"column-header"},[e("h4",{staticClass:"column-title"},[t._v("已选功能")]),e("el-button",{staticClass:"select-all-btn",attrs:{type:"text"},on:{click:t.deselectAll}},[t._v("全选")])],1),e("div",{staticClass:"function-list"},[t.selectedList.length>0?e("div",t._l(t.selectedList,(function(s){return e("div",{key:s.name,staticClass:"function-item"},[e("el-checkbox",{attrs:{label:s.name},on:{change:e=>t.handleCheckboxChange(s,e)},nativeOn:{click:function(t){t.stopPropagation()}},model:{value:t.selectedNames,callback:function(e){t.selectedNames=e},expression:"selectedNames"}}),e("div",{staticClass:"func-tag",on:{click:function(e){return t.handleFunctionClick(s)}}},[e("div",{staticClass:"color-dot",style:{backgroundColor:t.getFunctionColor(s.name)}}),e("span",[t._v(t._s(s.name))])])],1)})),0):e("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[e("el-empty",{attrs:{description:"请选择插件功能"}})],1)])]),e("div",{staticClass:"params-column"},[t.currentFunction?e("h4",{staticClass:"column-title"},[t._v("参数配置 - "+t._s(t.currentFunction.name))]):t._e(),t.currentFunction?e("div",{staticClass:"params-container"},[e("el-form",{staticClass:"param-form",attrs:{model:t.currentFunction}},[0==t.currentFunction.fieldsMeta.length?e("div",[e("el-empty",{attrs:{description:t.currentFunction.name+" 无需配置参数"}})],1):t._e(),t._l(t.currentFunction.fieldsMeta,(function(a){return e("el-form-item",{key:a.key,staticClass:"param-item",class:{"textarea-field":"array"===a.type||"json"===a.type},attrs:{label:a.label},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",{staticStyle:{"font-size":"16px","margin-right":"6px"}},[t._v(t._s(a.label))]),e("el-tooltip",{attrs:{effect:"dark",content:t.fieldRemark(a),placement:"top"}},[e("img",{staticClass:"info-icon",attrs:{src:s(6938),alt:""}})])]},proxy:!0}],null,!0)},["array"===a.type?e("el-input",{attrs:{type:"textarea"},on:{change:e=>t.handleParamChange(t.currentFunction,a.key,e)},model:{value:t.currentFunction.params[a.key],callback:function(e){t.$set(t.currentFunction.params,a.key,e)},expression:"currentFunction.params[field.key]"}}):"json"===a.type?e("el-input",{attrs:{type:"textarea",rows:6,placeholder:"请输入合法的 JSON"},on:{blur:function(e){return t.flushJson(a)}},model:{value:t.textCache[a.key],callback:function(e){t.$set(t.textCache,a.key,e)},expression:"textCache[field.key]"}}):"number"===a.type?e("el-input-number",{attrs:{value:t.currentFunction.params[a.key]},on:{change:e=>t.handleParamChange(t.currentFunction,a.key,e)}}):"boolean"===a.type||"bool"===a.type?e("el-switch",{attrs:{value:t.currentFunction.params[a.key]},on:{change:e=>t.handleParamChange(t.currentFunction,a.key,e)}}):e("el-input",{on:{change:e=>t.handleParamChange(t.currentFunction,a.key,e)},model:{value:t.currentFunction.params[a.key],callback:function(e){t.$set(t.currentFunction.params,a.key,e)},expression:"currentFunction.params[field.key]"}})],1)}))],2)],1):e("div",{staticClass:"empty-tip"},[t._v("请选择已配置的功能进行参数设置")])])]),e("div",{staticClass:"mcp-access-point"},[e("div",{staticClass:"mcp-container"},[e("div",{staticClass:"mcp-left"},[e("div",{staticClass:"mcp-header"},[e("h3",{staticClass:"bold-title"},[t._v("MCP接入点")])]),e("div",{staticClass:"url-header"},[e("div",{staticClass:"address-desc"},[e("span",[t._v("以下是智能体的MCP接入点地址。")]),e("a",{staticClass:"doc-link",attrs:{href:"https://github.com/xinnan-tech/xiaozhi-esp32-server/blob/main/docs/mcp-endpoint-enable.md",target:"_blank"}},[t._v("如何部署MCP接入点")]),t._v("   |   "),e("a",{staticClass:"doc-link",attrs:{href:"https://github.com/xinnan-tech/xiaozhi-esp32-server/blob/main/docs/mcp-endpoint-integration.md",target:"_blank"}},[t._v("如何接入MCP功能")]),t._v("   ")])]),e("el-input",{staticClass:"url-input",attrs:{readonly:""},scopedSlots:t._u([{key:"suffix",fn:function(){return[e("el-button",{staticClass:"inner-copy-btn",attrs:{icon:"el-icon-document-copy"},on:{click:t.copyUrl}},[t._v(" 复制 ")])]},proxy:!0}]),model:{value:t.mcpUrl,callback:function(e){t.mcpUrl=e},expression:"mcpUrl"}})],1),e("div",{staticClass:"mcp-right"},[e("div",{staticClass:"mcp-header"},[e("h3",{staticClass:"bold-title"},[t._v("接入点状态")])]),e("div",{staticClass:"status-container"},[e("span",{staticClass:"status-indicator",class:t.mcpStatus}),e("span",{staticClass:"status-text"},[t._v(t._s("connected"===t.mcpStatus?"已连接":"loading"===t.mcpStatus?"加载中...":"未连接"))]),e("button",{staticClass:"refresh-btn",on:{click:t.refreshStatus}},[e("span",{staticClass:"refresh-icon"},[t._v("↻")]),e("span",[t._v("刷新")])])]),e("div",{staticClass:"mcp-tools-list"},[t.mcpTools.length>0?e("div",{staticClass:"tools-grid"},t._l(t.mcpTools,(function(s){return e("el-button",{key:s,staticClass:"tool-btn",attrs:{size:"small",plain:""}},[t._v(" "+t._s(s)+" ")])})),1):e("div",{staticClass:"no-tools"},[e("span",[t._v("暂无可用工具")])])])])])]),e("div",{staticClass:"drawer-footer"},[e("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.saveSelection}},[t._v("保存配置")])],1)])}),[],!1,null,"495e1e27",null).exports,i={name:"RoleConfigPage",components:{HeaderBar:s(7853).A,FunctionDialog:n},data(){return{form:{agentCode:"",agentName:"",ttsVoiceId:"",chatHistoryConf:0,systemPrompt:"",summaryMemory:"",langCode:"",language:"",sort:"",model:{ttsModelId:"",vadModelId:"",asrModelId:"",llmModelId:"",vllmModelId:"",memModelId:"",intentModelId:""}},models:[{label:"语音活动检测(VAD)",key:"vadModelId",type:"VAD"},{label:"语音识别(ASR)",key:"asrModelId",type:"ASR"},{label:"大语言模型(LLM)",key:"llmModelId",type:"LLM"},{label:"视觉大模型(VLLM)",key:"vllmModelId",type:"VLLM"},{label:"意图识别(Intent)",key:"intentModelId",type:"Intent"},{label:"记忆(Memory)",key:"memModelId",type:"Memory"},{label:"语音合成(TTS)",key:"ttsModelId",type:"TTS"}],modelOptions:{},templates:[],loadingTemplate:!1,voiceOptions:[],showFunctionDialog:!1,currentFunctions:[],functionColorMap:["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEEAD","#D4A5A5","#A2836E"],allFunctions:[],originalFunctions:[]}},methods:{goToHome(){this.$router.push("/home")},saveConfig(){const t={agentCode:this.form.agentCode,agentName:this.form.agentName,asrModelId:this.form.model.asrModelId,vadModelId:this.form.model.vadModelId,llmModelId:this.form.model.llmModelId,vllmModelId:this.form.model.vllmModelId,ttsModelId:this.form.model.ttsModelId,ttsVoiceId:this.form.ttsVoiceId,chatHistoryConf:this.form.chatHistoryConf,memModelId:this.form.model.memModelId,intentModelId:this.form.model.intentModelId,systemPrompt:this.form.systemPrompt,summaryMemory:this.form.summaryMemory,langCode:this.form.langCode,language:this.form.language,sort:this.form.sort,functions:this.currentFunctions.map((t=>({pluginId:t.id,paramInfo:t.params})))};a.A.agent.updateAgentConfig(this.$route.query.agentId,t,(({data:t})=>{0===t.code?this.$message.success({message:"配置保存成功",showClose:!0}):this.$message.error({message:t.msg||"配置保存失败",showClose:!0})}))},resetConfig(){this.$confirm("确定要重置配置吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.form={agentCode:"",agentName:"",ttsVoiceId:"",chatHistoryConf:0,systemPrompt:"",summaryMemory:"",langCode:"",language:"",sort:"",model:{ttsModelId:"",vadModelId:"",asrModelId:"",llmModelId:"",vllmModelId:"",memModelId:"",intentModelId:""}},this.currentFunctions=[],this.$message.success({message:"配置已重置",showClose:!0})})).catch((()=>{}))},fetchTemplates(){a.A.agent.getAgentTemplate((({data:t})=>{0===t.code?this.templates=t.data:this.$message.error(t.msg||"获取模板列表失败")}))},selectTemplate(t){if(!this.loadingTemplate){this.loadingTemplate=!0;try{this.applyTemplateData(t),this.$message.success({message:`「${t.agentName}」模板已应用`,showClose:!0})}catch(t){this.$message.error({message:"应用模板失败",showClose:!0}),console.error("应用模板失败:",t)}finally{this.loadingTemplate=!1}}},applyTemplateData(t){this.form={...this.form,agentName:t.agentName||this.form.agentName,ttsVoiceId:t.ttsVoiceId||this.form.ttsVoiceId,chatHistoryConf:t.chatHistoryConf||this.form.chatHistoryConf,systemPrompt:t.systemPrompt||this.form.systemPrompt,summaryMemory:t.summaryMemory||this.form.summaryMemory,langCode:t.langCode||this.form.langCode,model:{ttsModelId:t.ttsModelId||this.form.model.ttsModelId,vadModelId:t.vadModelId||this.form.model.vadModelId,asrModelId:t.asrModelId||this.form.model.asrModelId,llmModelId:t.llmModelId||this.form.model.llmModelId,vllmModelId:t.vllmModelId||this.form.model.vllmModelId,memModelId:t.memModelId||this.form.model.memModelId,intentModelId:t.intentModelId||this.form.model.intentModelId}}},fetchAgentConfig(t){a.A.agent.getDeviceConfig(t,(({data:t})=>{if(0===t.code){this.form={...this.form,...t.data,model:{ttsModelId:t.data.ttsModelId,vadModelId:t.data.vadModelId,asrModelId:t.data.asrModelId,llmModelId:t.data.llmModelId,vllmModelId:t.data.vllmModelId,memModelId:t.data.memModelId,intentModelId:t.data.intentModelId}};const e=t.data.functions||[];(this.allFunctions.length?Promise.resolve():this.fetchAllFunctions()).then((()=>{this.currentFunctions=e.map((t=>{const e=this.allFunctions.find((e=>e.id===t.pluginId));return e?{id:t.pluginId,name:e.name,params:t.paramInfo||{...e.params},fieldsMeta:e.fieldsMeta}:{id:t.pluginId,name:t.pluginId,params:{}}})),this.originalFunctions=JSON.parse(JSON.stringify(this.currentFunctions))}))}else this.$message.error(t.msg||"获取配置失败")}))},fetchModelOptions(){this.models.forEach((t=>{a.A.model.getModelNames(t.type,"",(({data:e})=>{0===e.code?this.$set(this.modelOptions,t.type,e.data.map((t=>({value:t.id,label:t.modelName})))):this.$message.error(e.msg||"获取模型列表失败")}))}))},fetchVoiceOptions(t){t?a.A.model.getModelVoices(t,"",(({data:t})=>{0===t.code&&t.data?this.voiceOptions=t.data.map((t=>({value:t.id,label:t.name}))):this.voiceOptions=[]})):this.voiceOptions=[]},getFunctionColor(t){const e=[...t].reduce(((t,e)=>t+e.charCodeAt(0)),0);return this.functionColorMap[e%this.functionColorMap.length]},showFunctionIcons(t){return"Intent"===t&&"Intent_nointent"!==this.form.model.intentModelId},handleModelChange(t,e){"Intent"===t&&"Intent_nointent"!==e&&this.fetchAllFunctions(),"Memory"===t&&"Memory_nomem"===e&&(this.form.chatHistoryConf=0),"Memory"!==t||"Memory_nomem"===e||0!==this.form.chatHistoryConf&&null!==this.form.chatHistoryConf||(this.form.chatHistoryConf=2)},fetchAllFunctions(){return new Promise(((t,e)=>{a.A.model.getPluginFunctionList(null,(({data:s})=>{0===s.code?(this.allFunctions=s.data.map((t=>{const e=JSON.parse(t.fields||"[]"),s=e.reduce(((t,e)=>(t[e.key]=e.default,t)),{});return{...t,fieldsMeta:e,params:s}})),t()):(this.$message.error(s.msg||"获取插件列表失败"),e())}))}))},openFunctionDialog(){0===this.allFunctions.length?this.fetchAllFunctions().then((()=>this.showFunctionDialog=!0)):this.showFunctionDialog=!0},handleUpdateFunctions(t){this.currentFunctions=t},handleDialogClosed(t){t?this.originalFunctions=JSON.parse(JSON.stringify(this.currentFunctions)):this.currentFunctions=JSON.parse(JSON.stringify(this.originalFunctions)),this.showFunctionDialog=!1},updateChatHistoryConf(){"Memory_nomem"===this.form.model.memModelId&&(this.form.chatHistoryConf=0)}},watch:{"form.model.ttsModelId":{handler(t,e){e&&t!==e?(this.form.ttsVoiceId="",this.fetchVoiceOptions(t)):this.fetchVoiceOptions(t)},immediate:!0},voiceOptions:{handler(t){t&&t.length>0&&!this.form.ttsVoiceId&&(this.form.ttsVoiceId=t[0].value)},immediate:!0}},mounted(){const t=this.$route.query.agentId;t&&(this.fetchAgentConfig(t),this.fetchAllFunctions()),this.fetchModelOptions(),this.fetchTemplates()}},c=(0,l.A)(i,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"welcome"},[e("HeaderBar"),t._m(0),e("div",{staticClass:"main-wrapper"},[e("div",{staticClass:"content-panel"},[e("div",{staticClass:"content-area"},[e("el-card",{staticClass:"config-card",attrs:{shadow:"never"}},[e("div",{staticClass:"config-header"},[e("div",{staticClass:"header-icon"},[e("img",{attrs:{loading:"lazy",src:s(4498),alt:""}})]),e("span",{staticClass:"header-title"},[t._v(t._s(t.form.agentName))]),e("div",{staticClass:"header-actions"},[e("div",{staticClass:"hint-text"},[e("img",{attrs:{loading:"lazy",src:s(6938),alt:""}}),e("span",[t._v("保存配置后，需要重启设备，新的配置才会生效。")])]),e("el-button",{staticClass:"save-btn",attrs:{type:"primary"},on:{click:t.saveConfig}},[t._v("保存配置")]),e("el-button",{staticClass:"reset-btn",on:{click:t.resetConfig}},[t._v("重置")]),e("button",{staticClass:"custom-close-btn",on:{click:t.goToHome}},[t._v(" × ")])],1)]),e("div",{staticClass:"divider"}),e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"72px"}},[e("div",{staticClass:"form-content"},[e("div",{staticClass:"form-grid"},[e("div",{staticClass:"form-column"},[e("el-form-item",{attrs:{label:"助手昵称："}},[e("el-input",{staticClass:"form-input",attrs:{maxlength:"10"},model:{value:t.form.agentName,callback:function(e){t.$set(t.form,"agentName",e)},expression:"form.agentName"}})],1),e("el-form-item",{attrs:{label:"角色模版："}},[e("div",{staticClass:"template-container"},t._l(t.templates,(function(s,a){return e("div",{key:`template-${a}`,staticClass:"template-item",class:{"template-loading":t.loadingTemplate},on:{click:function(e){return t.selectTemplate(s)}}},[t._v(" "+t._s(s.agentName)+" ")])})),0)]),e("el-form-item",{attrs:{label:"角色介绍："}},[e("el-input",{staticClass:"form-textarea",attrs:{type:"textarea",rows:"9",resize:"none",placeholder:"请输入内容",maxlength:"2000","show-word-limit":""},model:{value:t.form.systemPrompt,callback:function(e){t.$set(t.form,"systemPrompt",e)},expression:"form.systemPrompt"}})],1),e("el-form-item",{attrs:{label:"记忆："}},[e("el-input",{staticClass:"form-textarea",attrs:{type:"textarea",rows:"6",resize:"none",maxlength:"2000","show-word-limit":"",disabled:"Memory_mem_local_short"!==t.form.model.memModelId},model:{value:t.form.summaryMemory,callback:function(e){t.$set(t.form,"summaryMemory",e)},expression:"form.summaryMemory"}})],1),e("el-form-item",{staticStyle:{display:"none"},attrs:{label:"语言编码："}},[e("el-input",{staticClass:"form-input",attrs:{placeholder:"请输入语言编码，如：zh_CN",maxlength:"10","show-word-limit":""},model:{value:t.form.langCode,callback:function(e){t.$set(t.form,"langCode",e)},expression:"form.langCode"}})],1),e("el-form-item",{staticStyle:{display:"none"},attrs:{label:"交互语种："}},[e("el-input",{staticClass:"form-input",attrs:{placeholder:"请输入交互语种，如：中文",maxlength:"10","show-word-limit":""},model:{value:t.form.language,callback:function(e){t.$set(t.form,"language",e)},expression:"form.language"}})],1)],1),e("div",{staticClass:"form-column"},[e("div",{staticClass:"model-row"},[e("el-form-item",{staticClass:"model-item",attrs:{label:"语音活动检测(VAD)"}},[e("div",{staticClass:"model-select-wrapper"},[e("el-select",{staticClass:"form-select",attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){return t.handleModelChange("VAD",e)}},model:{value:t.form.model.vadModelId,callback:function(e){t.$set(t.form.model,"vadModelId",e)},expression:"form.model.vadModelId"}},t._l(t.modelOptions.VAD,(function(t,s){return e("el-option",{key:`option-vad-${s}`,attrs:{label:t.label,value:t.value}})})),1)],1)]),e("el-form-item",{staticClass:"model-item",attrs:{label:"语音识别(ASR)"}},[e("div",{staticClass:"model-select-wrapper"},[e("el-select",{staticClass:"form-select",attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){return t.handleModelChange("ASR",e)}},model:{value:t.form.model.asrModelId,callback:function(e){t.$set(t.form.model,"asrModelId",e)},expression:"form.model.asrModelId"}},t._l(t.modelOptions.ASR,(function(t,s){return e("el-option",{key:`option-asr-${s}`,attrs:{label:t.label,value:t.value}})})),1)],1)])],1),t._l(t.models.slice(2),(function(s,a){return e("el-form-item",{key:`model-${a}`,staticClass:"model-item",attrs:{label:s.label}},[e("div",{staticClass:"model-select-wrapper"},[e("el-select",{staticClass:"form-select",attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){return t.handleModelChange(s.type,e)}},model:{value:t.form.model[s.key],callback:function(e){t.$set(t.form.model,s.key,e)},expression:"form.model[model.key]"}},t._l(t.modelOptions[s.type],(function(t,s){return e("el-option",{key:`option-${a}-${s}`,attrs:{label:t.label,value:t.value}})})),1),t.showFunctionIcons(s.type)?e("div",{staticClass:"function-icons"},[t._l(t.currentFunctions,(function(s){return e("el-tooltip",{key:s.name,attrs:{effect:"dark",placement:"top","popper-class":"custom-tooltip"}},[e("div",{attrs:{slot:"content"},slot:"content"},[e("div",[e("strong",[t._v("功能名称:")]),t._v(" "+t._s(s.name))])]),e("div",{staticClass:"icon-dot",style:{backgroundColor:t.getFunctionColor(s.name)}},[t._v(" "+t._s(s.name.charAt(0))+" ")])])})),e("el-button",{staticClass:"edit-function-btn",class:{"active-btn":t.showFunctionDialog},on:{click:t.openFunctionDialog}},[t._v(" 编辑功能 ")])],2):t._e(),"Memory"===s.type&&"Memory_nomem"!==t.form.model.memModelId?e("div",{staticClass:"chat-history-options"},[e("el-radio-group",{on:{change:t.updateChatHistoryConf},model:{value:t.form.chatHistoryConf,callback:function(e){t.$set(t.form,"chatHistoryConf",e)},expression:"form.chatHistoryConf"}},[e("el-radio-button",{attrs:{label:1}},[t._v("上报文字")]),e("el-radio-button",{attrs:{label:2}},[t._v("上报文字+语音")])],1)],1):t._e()],1)])})),e("el-form-item",{attrs:{label:"角色音色"}},[e("el-select",{staticClass:"form-select",attrs:{placeholder:"请选择"},model:{value:t.form.ttsVoiceId,callback:function(e){t.$set(t.form,"ttsVoiceId",e)},expression:"form.ttsVoiceId"}},t._l(t.voiceOptions,(function(t,s){return e("el-option",{key:`voice-${s}`,attrs:{label:t.label,value:t.value}})})),1)],1)],2)])])])],1)],1)])]),e("function-dialog",{attrs:{functions:t.currentFunctions,"all-functions":t.allFunctions,"agent-id":t.$route.query.agentId},on:{"update-functions":t.handleUpdateFunctions,"dialog-closed":t.handleDialogClosed},model:{value:t.showFunctionDialog,callback:function(e){t.showFunctionDialog=e},expression:"showFunctionDialog"}})],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"operation-bar"},[t("h2",{staticClass:"page-title"},[this._v("角色配置")])])}],!1,null,"46e1923a",null).exports}}]);